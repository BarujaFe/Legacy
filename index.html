<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bom dia, Felipe! ‚Äî Painel</title>

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --white:#e6eef8;
    --muted:#94a3b8;
    --bg:#000;
    --card:#031424;
  }
  body{
    font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    margin:16px;
    background:var(--bg);
    color:var(--white);
  }
  .wrap{
    max-width:1760px;   /* ajustado pra caber 2 gr√°ficos + gap */
    margin:0 auto;
  }
  .top-actions{display:flex;flex-direction:column;gap:8px;align-items:center;margin-bottom:18px;text-align:center}
  .greeting{font-size:32px;font-weight:700;}
  .links{display:flex;justify-content:center;gap:8px}
  .link{display:flex;gap:8px;align-items:center;background:transparent;padding:6px;border-radius:8px}
  .url{color:var(--white);text-decoration:underline}
  .btn{padding:6px 10px;background:#111;border:1px solid #222;color:var(--white);border-radius:8px;cursor:pointer}
  .small{font-size:14px;color:var(--muted)}

  /* charts - lado a lado fixos */
  .chart-row{
    display:flex;
    gap:16px;
    justify-content:center;
    align-items:flex-start;
    flex-wrap:nowrap; /* n√£o quebra em telas grandes */
    margin-bottom:18px;
  }
  .chart-card{
    width:1000px;   /* largura ajustada */
    height:610px;  /* altura fixa */
    border-radius:8px;
    overflow:hidden;
    border:1px solid rgba(255,255,255,0.06);
    background:#041826;
    display:flex;
    flex-direction:column;
    align-items:center;
    box-sizing:border-box;
  }
  .chart-card h2{margin:8px 0;color:var(--white);text-align:center;font-size:18px;padding:0 8px}
  .chart-iframe{width:100%;height:100%;border:0;display:block}

  /* assets selector */
  .card{background:transparent;border-radius:12px;padding:8px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px;justify-content:center}
  .assets{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;justify-content:center}
  .asset-item{background:#061821;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);min-width:240px;box-sizing:border-box}
  .asset-item label{display:flex;gap:8px;align-items:center;cursor:pointer}
  .smallbtn{padding:6px 10px;background:#111;border:1px solid #222;color:var(--white);border-radius:6px;cursor:pointer;font-size:13px}

  /* priority section */
  .priority-list{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-bottom:8px}
  .priority-item{background:#08303a;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);min-width:180px;display:flex;align-items:center;gap:8px}

  /* blocks */
  .side-by-side{display:flex;gap:16px;flex-wrap:wrap;justify-content:space-between}
  .block{flex:1;min-width:300px}
  .text-block{background:var(--card);border-radius:8px;padding:12px;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;white-space:pre-wrap;line-height:1.4;cursor:pointer;color:var(--muted);max-height:420px;overflow:auto;border:1px solid rgba(255,255,255,0.03)}
  textarea.template{width:100%;height:140px;background:#021319;color:var(--white);border-radius:8px;padding:8px;border:1px solid #10323a;resize:vertical}

  footer{margin-top:18px;font-size:20px;color:var(--muted);text-align:center;font-weight:600}

  .hint{font-size:12px;color:var(--muted);margin-top:6px;text-align:center}

  /* Responsivo: em telas pequenas escala mantendo propor√ß√£o */
  @media (max-width:1920=px){
    .chart-row{flex-wrap:wrap;} /* se n√£o couber, quebra embaixo */
    .chart-card{
      width:92vw;
      height:calc(92vw * 610 / 1000); /* mant√©m propor√ß√£o exata */
    }
    .asset-item{min-width:48%}
    .side-by-side{flex-direction:column}
    .priority-item{min-width:45%}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="top-actions">
      <div class="greeting">Bom dia, Felipe! Tenha um √≥timo dia! üôè</div>
      <div class="links">
        <div class="link">
          <a class="url" href="https://www.invertexto.com/localizar-e-substituir" target="_blank" rel="noopener noreferrer">Invertexto ‚Äî localizar e substituir</a>
          <button class="btn" onclick="copyText(event,'https://www.invertexto.com/localizar-e-substituir')">Copiar</button>
        </div>
      </div>
      <div class="small">Clique em qualquer bloco de texto ou bot√£o de copiar. Links abrem em nova guia.</div>
    </div>

    <!-- Charts (top) -->
    <div class="chart-row" aria-hidden="false">
      <div class="chart-card" role="region" aria-label="Gr√°fico de Pizza">
        <h2>Gr√°fico de Pizza</h2>
        <iframe class="chart-iframe" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRfMop3o2aoueAAq0TJ07xVDBaUVy4pV03Ac4blEnX5sziR9OFv8xXH0jKKBU67QSzo8wRf0uaIXcbG/pubchart?oid=111637926&format=interactive" loading="lazy"></iframe>
      </div>

      <div class="chart-card" role="region" aria-label="Acompanhamento Di√°rio">
        <h2>Acompanhamento Di√°rio</h2>
        <iframe class="chart-iframe" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRfMop3o2aoueAAq0TJ07xVDBaUVy4pV03Ac4blEnX5sziR9OFv8xXH0jKKBU67QSzo8wRf0uaIXcbG/pubchart?oid=1425520939&format=interactive" loading="lazy"></iframe>
      </div>
    </div>
    
    <!-- Assets selector -->
    <div class="card" style="margin-bottom:18px;">
      <h2 style="text-align:center">Selecionar ativos para an√°lise</h2>
      <div class="controls">
        <button class="smallbtn" id="selectAll">Selecionar todos</button>
        <button class="smallbtn" id="clearAll">Limpar tudo</button>
        <button class="smallbtn" id="saveBtn">Salvar sele√ß√£o</button>
      </div>

      <!-- PRIORITY: user-requested assets (rendered first) -->
      <div id="priorityContainer" class="priority-list" aria-live="polite"></div>

      <!-- remaining assets -->
      <div id="assetsContainer" class="assets" aria-live="polite"></div>
      <p class="hint">Ao alterar sele√ß√£o, os blocos do Gemini, ChatGPT e o script ser√£o atualizados automaticamente. A √∫ltima sele√ß√£o √© salva no navegador.</p>
    </div>

    <!-- Gemini and ChatGPT side-by-side -->
    <div class="side-by-side" style="margin-bottom:12px;">
      <div class="block card">
        <h2>1. Ao Gemini</h2>
        <div style="margin-bottom:6px"><a class="url" href="https://gemini.google.com/app?hl=pt-BR" target="_blank" rel="noopener noreferrer">Abrir Gemini</a></div>
        <div id="geminiBlock" class="text-block" tabindex="0" title="Clique para copiar" data-copy>
üí¨ Instru√ß√µes para o Gemini ‚Äì (cole o template ao editar)
        </div>

        <div style="display:flex;gap:8px;margin-top:8px;">
          <button class="smallbtn" id="copyGemini">Copiar Gemini (gerado)</button>
          <button class="smallbtn" id="toggleGeminiTemplate">Editar template</button>
        </div>
        <textarea id="geminiTemplate" class="template" placeholder="Cole aqui o template do Gemini com {{ASSETS}} onde quer a lista" style="display:none"></textarea>
        <p class="hint">Edite o template e salve. O bot√£o 'Copiar Gemini' pega o prompt j√° preenchido com os ativos selecionados.</p>
      </div>

      <div class="block card">
        <h2>2. Ao ChatGPT</h2>
        <div style="margin-bottom:6px"><a class="url" href="https://chat.openai.com/" target="_blank" rel="noopener noreferrer">Abrir ChatGPT</a></div>
        <div id="chatgptBlock" class="text-block" tabindex="0" title="Clique para copiar" data-copy>
üí¨ Mensagem de in√≠cio de conversa para o ChatGPT ‚Äî (cole o template ao editar)
        </div>

        <div style="display:flex;gap:8px;margin-top:8px;">
          <button class="smallbtn" id="copyChat">Copiar ChatGPT (gerado)</button>
          <button class="smallbtn" id="toggleChatTemplate">Editar template</button>
        </div>
        <textarea id="chatTemplate" class="template" placeholder="Cole aqui o template do ChatGPT com {{ASSETS}} onde quer a lista" style="display:none"></textarea>
        <p class="hint">Edite o template e salve. O bot√£o 'Copiar ChatGPT' pega o prompt j√° preenchido com os ativos selecionados.</p>
      </div>
    </div>

    <!-- WebScraping block -->
    <div class="card" style="margin-top:6px;">
      <h2 style="text-align:center">3. WebScraping (Python)</h2>
      <div id="scriptBlock" class="text-block" tabindex="0" title="Clique para copiar" data-copy>
# Placeholder ‚Äî o script ser√° atualizado com a lista de s√≠mbolos selecionados
      </div>
      <div style="margin-top:8px;text-align:center"><button class="btn" id="copyScriptBtn">Copiar script Python</button></div>
    </div>

    <footer>
      <p style="font-family:Garamond,serif;margin-top:8px;text-align:center">O sucesso n√£o √© um acidente. √â uma escolha que voc√™ faz, todos os dias.</p>
    </footer>
  </div>

  <div id="toast" style="position:fixed;right:18px;bottom:18px;background:#06b6d4;color:#042023;padding:10px 14px;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,0.5);transform:translateY(12px);opacity:0;pointer-events:none;transition:all .28s ease">Copiado!</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  // ===== config / data =====
  // PRIORITY assets (user requested) - shown ABOVE the main list
  const PRIORITY_URLS = [
    { sym: "AAPL34", name: "Apple üçé", url: "https://br.tradingview.com/symbols/NASDAQ-AAPL/technicals/" },
    { sym: "ETH", name: "Ethereum ‚ú®", url: "https://br.tradingview.com/symbols/ETHUSD/technicals/?exchange=BINANCE" },
    { sym: "SOL", name: "Solana ‚òÄÔ∏è", url: "https://br.tradingview.com/symbols/SOLUSD/technicals/?exchange=BINANCE" },
    { sym: "BABA34", name: "Alibaba üõçÔ∏è", url: "https://br.tradingview.com/symbols/NYSE-BABA/technicals/" },
    { sym: "LINK", name: "Chainlink ‚õìÔ∏è", url: "https://br.tradingview.com/symbols/LINKUSD/technicals/?exchange=BINANCE" },
    { sym: "SUI", name: "Sui üåä", url: "https://br.tradingview.com/symbols/SUIUSD/technicals/?exchange=BINANCE" },
    { sym: "RENDER", name: "Render üé®", url: "https://br.tradingview.com/symbols/RENDERUSD/technicals/?exchange=BINANCE" },
    { sym: "MELI34", name: "MercadoLibre üõí", url: "https://br.tradingview.com/symbols/NASDAQ-MELI/technicals/" }
  ];

  // Main (long) list copied from your provided list (subset included here; you can paste entire list if desired)
  const URL_LIST = [
    "https://br.tradingview.com/symbols/BTCUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/ETHUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/XRPUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/TUSDUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/BNBUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/SOLUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/USDCUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/STETHUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/DOGEUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/ADAUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/TRXUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/HBARUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/SUIUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/BCHUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/AVAXUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/LTCUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/LINKUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/DOTUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/UNIUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/AAVEUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/ENAUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/ETCUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/TAOUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/NEARUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/APTUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/ONDOUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/ARBUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/ICPUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/POLUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/ALGOUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/VETUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/ATOMUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/SHIBUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/PEPEUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/CROUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/TONUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/HYPERUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/WBTCUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/WSTETHUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/WBEETHUSD/technicals/?exchange=BINANCE",
    "https://br.tradingview.com/symbols/NASDAQ-NVDA/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-MSFT/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-AAPL/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-GOOGL/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-AMZN/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-META/technicals/",
    "https://br.tradingview.com/symbols/TADAWUL-2222/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-AVGO/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-TSLA/technicals/",
    "https://br.tradingview.com/symbols/NYSE-TSM/technicals/",
    "https://br.tradingview.com/symbols/NYSE-JPM/technicals/",
    "https://br.tradingview.com/symbols/NYSE-WMT/technicals/",
    "https://br.tradingview.com/symbols/NYSE-TMO/technicals/",
    "https://br.tradingview.com/symbols/NYSE-LLY/technicals/",
    "https://br.tradingview.com/symbols/NYSE-PG/technicals/",
    "https://br.tradingview.com/symbols/NYSE-ORCL/technicals/",
    "https://br.tradingview.com/symbols/NYSE-MA/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-NFLX/technicals/",
    "https://br.tradingview.com/symbols/NYSE-BABA/technicals/",
    "https://br.tradingview.com/symbols/NYSE-DIS/technicals/",
    "https://br.tradingview.com/symbols/NYSE-XOM/technicals/",
    "https://br.tradingview.com/symbols/NYSE-HD/technicals/",
    "https://br.tradingview.com/symbols/NYSE-PFE/technicals/",
    "https://br.tradingview.com/symbols/NYSE-BAC/technicals/",
    "https://br.tradingview.com/symbols/NYSE-KO/technicals/",
    "https://br.tradingview.com/symbols/SSE-601398/technicals/",
    "https://br.tradingview.com/symbols/SSE-601288/technicals/",
    "https://br.tradingview.com/symbols/KRX-005930/technicals/",
    "https://br.tradingview.com/symbols/NYSE-CVX/technicals/",
    "https://br.tradingview.com/symbols/XETR-SAP/technicals/",
    "https://br.tradingview.com/symbols/NYSE-BHP/technicals/",
    "https://br.tradingview.com/symbols/NYSE-HSBC/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-ASML/technicals/",
    "https://br.tradingview.com/symbols/NYSE-GE/technicals/",
    "https://br.tradingview.com/symbols/USOTC-LVMUY/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-SMCI/technicals/",
    "https://br.tradingview.com/symbols/NYSE-CRM/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-CSCO/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-AMD/technicals/",
    "https://br.tradingview.com/symbols/NYSE-WFC/technicals/",
    "https://br.tradingview.com/symbols/HKEX-0268/technicals/",
    "https://br.tradingview.com/symbols/SSE-600519/technicals/",
    "https://br.tradingview.com/symbols/SSE-601997/technicals/",
    "https://br.tradingview.com/symbols/HKEX-1810/technicals/",
    "https://br.tradingview.com/symbols/HKEX-1299/technicals/",
    "https://br.tradingview.com/symbols/HKEX-0001/technicals/",
    "https://br.tradingview.com/symbols/TSE-7203/technicals/",
    "https://br.tradingview.com/symbols/SSE-600000/technicals/",
    "https://br.tradingview.com/symbols/EURONEXT-KER/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-AZN/technicals/",
    "https://br.tradingview.com/symbols/NYSE-UL/technicals/",
    "https://br.tradingview.com/symbols/TSE-7267/technicals/",
    "https://br.tradingview.com/symbols/NYSE-RY/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-BIDU/technicals/",
    "https://br.tradingview.com/symbols/NYSE-MS/technicals/",
    "https://br.tradingview.com/symbols/NYSE-KMB/technicals/",
    "https://br.tradingview.com/symbols/NYSE-ABT/technicals/",
    "https://br.tradingview.com/symbols/NYSE-AXP/technicals/",
    "https://br.tradingview.com/symbols/NYSE-VIV/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-CGC/technicals/",
    "https://br.tradingview.com/symbols/NYSE-BA/technicals/",
    "https://br.tradingview.com/symbols/NYSE-CVS/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-ADBE/technicals/",
    "https://br.tradingview.com/symbols/NASDAQ-CMCSA/technicals/"
  ];

  const STORAGE_KEY = 'ativosSelecionados_v2';
  const TEMPLATE_KEY_G = 'template_gemini_v1';
  const TEMPLATE_KEY_C = 'template_chat_v1';
  const assetsContainer = document.getElementById('assetsContainer');
  const priorityContainer = document.getElementById('priorityContainer');

  // friendly name maps (complete enough for common symbols)
  const NAME_MAP = {
    BTC: 'Bitcoin üü†', ETH: 'Ethereum ‚ú®', XRP: 'XRP üíß', TUSD: 'TrueUSD ‚úÖ', BNB: 'BNB üí∞', SOL: 'Solana ‚òÄÔ∏è',
    CUSD: 'Celo Dollar üå≥', STETH: 'Lido Staked ETH üßä', DOGE: 'Dogecoin üêï', ADA: 'Cardano ‚Ç≥', TRX: 'TRON üåê',
    HBAR: 'Hedera üåø', SUI: 'Sui üåä', BCH: 'Bitcoin Cash üíö', AVAX: 'Avalanche üèîÔ∏è', LTC: 'Litecoin ‚ö™',
    LINK: 'Chainlink ‚õìÔ∏è', DOT: 'Polkadot üî¥', UNI: 'Uniswap ü¶Ñ', AAVE: 'Aave üëª', ENA: 'Ethena üí≤',
    ETC: 'Ethereum Classic üóø', TAO: 'Bittensor üß†', NEAR: 'NEAR Protocol üá≥', APT: 'Aptos ‚öõÔ∏è', ONDO: 'Ondo üè¶',
    AR: 'Arweave üíæ', ICP: 'Internet Computer üñ•Ô∏è', POL: 'Polygon üî∫', ALGO: 'Algorand ‚ôæÔ∏è', VET: 'VeChain ‚õìÔ∏è',
    ATOM: 'Cosmos ‚öõÔ∏è', SHIB: 'Shiba Inu üêï', PEPE: 'Pepe üê∏', CRO: 'Cronos ‚öõÔ∏è', TON: 'The Open Network üíé',
    HYPER: 'Hyper ‚ö°', WBTC: 'Wrapped Bitcoin üåØ', WSTETH: 'Wrapped Staked ETH üéÅ', WBEETH: 'Wrapped BETH üéÄ',
    USDT: 'Tether ‚ÇÆ', USDC: 'USD Coin üí≤'
  };

  const NAME_MAP_STOCKS = {
    NVDA: 'NVIDIA üü©', MSFT: 'Microsoft ü™ü', AAPL: 'Apple üçé', AAPL34: 'Apple BDR üçé', GOOGL: 'Alphabet üîç',
    AMZN: 'Amazon üì¶', META: 'Meta Platforms ‚ôæÔ∏è', '2222': 'Aramco üá∏üá¶', AVGO: 'Broadcom üì°', TSLA: 'Tesla üöò',
    TSM: 'Taiwan Semiconductor üáπüáº', JPM: 'JPMorgan üè¶', WMT: 'Walmart üõí', TMO: 'Thermo Fisher üî¨',
    LLY: 'Eli Lilly üíä', PG: 'Procter & Gamble ‚ú®', ORCL: 'Oracle üíª', MA: 'Mastercard üí≥', NFLX: 'Netflix üçø',
    BABA: 'Alibaba üõçÔ∏è', BABA34: 'Alibaba BDR üõçÔ∏è', MELI: 'MercadoLibre üõí', MELI34: 'MercadoLibre BDR üõí'
  };

  // helper: extract symbol from tradingview url
  function extractSymbol(url){
    try {
      const m = url.match(/symbols\/([^\/]+)/i);
      if(!m) return url;
      let raw = m[1];
      // If contains exchange prefix like NASDAQ-NVDA -> take latter part
      if(raw.includes('-')) raw = raw.split('-').pop();
      // remove common fiat/ticker suffixes
      raw = raw.replace(/(USD|USDT|BUSD|USDC|BTC|ETH)$/i,'');
      return raw.toUpperCase();
    } catch (e){
      return url;
    }
  }

  function detectType(url){
    const stockMarkers = ['NASDAQ','NYSE','TSE','SSE','HKEX','KRX','TADAWUL','EURONEXT','USOTC','XETR'];
    const U = url.toUpperCase();
    for(const m of stockMarkers) if(U.includes(m)) return 'A√ß√£o';
    return 'Cripto';
  }

  // render a single asset checkbox element
  function makeAssetElement(sym, name, url, indexPrefix){
    const id = `${indexPrefix}_${sym}`;
    const div = document.createElement('div');
    div.className = 'asset-item';
    div.innerHTML = `<label for="${id}"><input id="${id}" type="checkbox" data-url="${url}" data-sym="${sym}"> <div><div style="font-weight:700">${sym}: ${name}</div><div style="opacity:.7;font-size:12px;margin-top:4px">(${detectType(url)})</div></div></label>`;
    return div;
  }

  // render assets checkboxes: priority first, then main list
  function renderAssets(){
    priorityContainer.innerHTML = '';
    assetsContainer.innerHTML = '';

    // render priority list
    PRIORITY_URLS.forEach((o,i)=>{
      const prettyName = o.name || (NAME_MAP[o.sym] || NAME_MAP_STOCKS[o.sym] || o.sym);
      const item = document.createElement('div');
      item.className = 'priority-item';
      item.innerHTML = `<label style="cursor:pointer"><input type="checkbox" data-url="${o.url}" data-sym="${o.sym}"> <div style="font-weight:700">${o.sym}: ${prettyName}</div></label>`;
      priorityContainer.appendChild(item);
    });

    // render main list (skipping duplicates based on sym)
    const seen = new Set(PRIORITY_URLS.map(x=>x.sym));
    URL_LIST.forEach((u,i)=>{
      const sym = extractSymbol(u);
      if(seen.has(sym)) return; // skip if already in priority
      const type = detectType(u);
      const name = (type==='Cripto' ? (NAME_MAP[sym] || sym) : (NAME_MAP_STOCKS[sym] || sym));
      const el = makeAssetElement(sym, name, u, 'asset');
      assetsContainer.appendChild(el);
    });
  }

  // load saved selection + templates
  function loadSelection(){
    const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    // attach listeners to priority items and main list after render
    document.querySelectorAll('#priorityContainer input[type=checkbox]').forEach(chk=>{
      chk.checked = saved.includes(chk.dataset.sym);
      chk.addEventListener('change', onSelectionChange);
    });
    document.querySelectorAll('#assetsContainer input[type=checkbox]').forEach(chk=>{
      chk.checked = saved.includes(chk.dataset.sym);
      chk.addEventListener('change', onSelectionChange);
    });

    const gtpl = localStorage.getItem(TEMPLATE_KEY_G) || '';
    const ctpl = localStorage.getItem(TEMPLATE_KEY_C) || '';
    document.getElementById('geminiTemplate').value = gtpl;
    document.getElementById('chatTemplate').value = ctpl;

    updateAllBlocks();
  }

  function saveSelection(vals){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(vals));
  }

  function onSelectionChange(){ updateAllBlocks(); }

  function getSelected(){
    const selects = Array.from(document.querySelectorAll('#priorityContainer input:checked, #assetsContainer input:checked'));
    return selects.map(c=>({
      sym:c.dataset.sym,
      url:c.dataset.url,
      type: detectType(c.dataset.url),
      name: getPrettyName(c.dataset.sym, c.dataset.url)
    }));
  }

  function getPrettyName(sym,url){
    const type = detectType(url);
    return (NAME_MAP[sym] || NAME_MAP_STOCKS[sym] || sym);
  }

  // build outputs
  function updateAllBlocks(){
    const selected = getSelected();

    // --- header + common functions for templates ---
    function getCurrentDateTime() {
        const now = new Date();
        const pad = (n) => n.toString().padStart(2, '0');
        return `${pad(now.getDate())}/${pad(now.getMonth() + 1)}/${now.getFullYear()} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
    }

    const header = `========================================
üìä IN√çCIO DE AN√ÅLISE DI√ÅRIA ‚Äî NOVO DIA
Data/Hora: ${getCurrentDateTime()}
========================================\n\n`;

    const assetsForPrompt = selected.length > 0 ? selected.map(s => `${s.sym}: ${s.name} ‚Äî ${s.url}`).join('\n') : '(nenhum ativo selecionado)';

    // Gemini template (uses current selection)
    const gemTpl = `
INSTRU√á√ïES DI√ÅRIAS ‚Äî BRIEFING MATINAL (PDFs/imagens + top lists) ‚Äî RESPOSTA EM PORTUGU√äS
Ativos para an√°lise:
${assetsForPrompt}

INSTRU√á√ïES DI√ÅRIAS ‚Äî BRIEFING MATINAL (PDFs/imagens + top lists) ‚Äî RESPOSTA EM PORTUGU√äS
Ol√° Gemini ‚Äî vou anexar PDFs (prints/imagens) com relat√≥rios t√©cnicos (TradingView e similares) e um PDF com a lista ‚Äútop‚Äù (v√°rios ativos). Use OCR para extrair todo o conte√∫do textual e t√©cnico das imagens. Os PDFs s√£o fonte priorit√°ria para sinais 1D/1S/1M ‚Äî confirme sempre com dados de mercado em tempo real (pre√ßo, volume, book depth).
Objetivo: entregar um briefing matinal di√°rio com panorama acion√°vel e muito detalhado (t√©cnico + on-chain/dev + not√≠cias) para eu gerenciar os ativos. Eu vou reenviar a sua sa√≠da para um assistente (ChatGPT) para revis√£o; portanto produza (A) um texto humano direto e (B) um JSON padronizado. O n√≠vel de detalhe deve ser o mesmo todos os dias, mesmo se eu mudar os ativos.

0) Aloca√ß√£o de refer√™ncia (estado atual ‚Äî mut√°vel)
Cripto (total da camada cripto):
ETH ‚Äî 45%
SOL ‚Äî 30%
LINK ‚Äî 15%
SUI ‚Äî 5%
RNDR ‚Äî 5%

A√ß√µes/BDR (total da camada a√ß√µes):
BABA34 ‚Äî 35%
AAPL34 ‚Äî 35%
MELI34 ‚Äî 30%
Nota: esses % s√£o refer√™ncia da ‚Äúvis√£o atual‚Äù e podem ser ajustados ‚Äî n√£o trate como ordem fixa.

1) Prioridades / fontes (ordem de import√¢ncia)
PDFs (OCR) ‚Äî extraia RSI, MACD, STOCHRSI, SMA20/50/200, piv√¥s S/R, coment√°rios do analista e anota√ß√µes. Cite p√°gina/arquivo.
Not√≠cias (√∫ltimos 30 dias) ‚Äî CoinDesk, The Block, Cointelegraph, Reuters, Bloomberg, sites oficiais, X/Twitter oficial do projeto. Link + data.
On-chain & dev (√∫ltimos 90 dias) ‚Äî commits GitHub, TVL (DefiLlama), active addresses, grandes transfers, vesting schedules.
Dados de mercado realtime ‚Äî pre√ßo, marketcap, volume24h, book depth nas exchanges principais (estimate slippage).

2) Ativos fixos (sempre priorizar nos blocos)
Os que sempre quero no briefing ‚Äî mesmo que eu troque depois: ETH, SOL, LINK, SUI, RNDR, BABA34, AAPL34, MELI34.
Al√©m disso, fa√ßa varredura autom√°tica do PDF ‚Äútop lists‚Äù e destaque at√© 5 ativos novos que mere√ßam aten√ß√£o hoje.

3) Sa√≠da HUMANA (texto curto, pr√°tico ‚Äî formato obrigat√≥rio)
Comece por HEADLINE (1 linha) ‚Äî tema do dia, com a mensagem crucial (ex.: ‚ÄúCripto em corre√ß√£o; BABA testando suporte; aten√ß√£o a unlocks em X/X/2025‚Äù).
Em seguida, entregue exatamente estes blocos em ordem:
A) Market Snapshot (3 bullets)
Movimento IP (ex.: ‚Äúcap. cripto -1.7% 24h; S&P futures +0.5; d√≥lar +0.3%‚Äù)
Macro / evento do dia (juros, CPI, FED, earnings relevantes)
Top 3 riscos do dia (ex.: unlocks, decis√£o regulat√≥ria, earnings)

B) Top Movers (Cripto) ‚Äî 5 maiores varia√ß√µes 24h
Linha por ativo: Ticker ‚Äî %24h ‚Äî motivo curto ‚Äî a√ß√£o sugerida (Buy / Wait / Monitor) ‚Äî link
C) Top Movers (A√ß√µes/BDR) ‚Äî 5 maiores varia√ß√µes 24h
Mesmo formato.
D) Blocos monitorados (um por ativo priorit√°rio ‚Äî template AUTOFILL; repetir para cada ativo listado em ¬ß2)
Ativo: [NOME] ‚Äî [TICKER]
Pre√ßo atual (valor ‚Äî fonte ‚Äî timestamp)
Pre√ßo estrat√©gico de refer√™ncia (do usu√°rio)
Dist√¢ncia at√© o alvo (%)
Resumo t√©cnico (PRIORIDADE: PDF ‚Üí realtime):
  - 1D: [Compra / Venda / Neutro] ‚Äî 1 frase com o sinal principal extra√≠do do PDF
  - 1S: [Compra / Venda / Neutro] ‚Äî 1 frase
  - 1M: [Compra / Venda / Neutro] ‚Äî 1 frase
Observa√ß√µes cr√≠ticas:
  - Diverg√™ncias (PDF vs realtime)
  - Suportes / Resist√™ncias chave (pre√ßos)
  - Eventos on-chain / unlocks (datas + %)
  - Notas do PDF (arquivo e p√°gina)
A√ß√£o recomendada (1 linha): [Comprar/Limit/Esperar/Monitorar] ‚Äî pre√ßo-limite sugerido (se aplic√°vel) ‚Äî stop % sugerido
Confian√ßa: [Alta / M√©dia / Baixa]
Principais fontes (m√°x 4): [PDF_nome_p√°gina, CoinGecko link, DefiLlama, GitHub]
Regra de proximidade (automatizada):
Dentro do range user (ex.: BABA 22,50‚Äì23,50) ‚Üí ‚Äúüö® oportunidade pr√≥xima‚Äù
At√© 10% acima ‚Üí ‚ÄúPr√≥ximo‚Äù
10% acima ‚Üí ‚ÄúAinda distante‚Äù

E) Panorama do top-list (varredura r√°pida)
At√© 5 ativos do PDF top-list que merecem aten√ß√£o HOJE (1 linha por ativo: s√≠mbolo ‚Äî motivo ‚Äî a√ß√£o sugerida).

F) Riscos / Alerts Imediatos
Lista com eventos cr√≠ticos (unlock % + data; earnings/regulatory; hard forks) e sugest√£o de alert (30/7/1 dias).

G) Execu√ß√£o pr√°tica (3 a√ß√µes imediatas)
Tr√™s a√ß√µes de 1 linha (ex.: ordens-limit sugeridas, alerts, venda parcial).

H) Confidence & fontes
Confidence geral do briefing (Alta/M√©dia/Baixa) + links (2‚Äì4) com timestamps.

4) Sa√≠da M√ÅQUINA (JSON) ‚Äî OBRIGAT√ìRIO
... (JSON schema mantido como no prompt original)

5) Extra√ß√µes obrigat√≥rias dos PDFs
RSI14, MACD hist, STOCHRSI, SMA20/50/200 (valores), Pivot S/R, e todo coment√°rio textual do analista (transcrever). Se n√£o leg√≠vel, escreva ‚Äún√£o dispon√≠vel (PDF: nome, p.X)‚Äù.

6) Verifica√ß√µes on-chain / dev (se aplic√°vel)
Pr√≥ximos unlocks / vesting: datas + % por evento (90/180/365d).
TVL changes (>10% dia) e active addresses (90d).
GitHub commits 90d (varia√ß√£o %).
Grandes transfers (> US$1M) nas √∫ltimas 72h (se token cripto).

7) Liquidez e execu√ß√£o
Para cada sugest√£o de compra, estimate slippage: calcule book depth nas 2 maiores exchanges e estime pre√ßo de execu√ß√£o para ordem equivalente a 0.5% do marketcap. Informe spread aproximado.

8) Follow-ups autom√°ticos (pr√©-criados)
Se o briefing identificar eventos cr√≠ticos (unlock >3% nos pr√≥ximos 30 dias; falha de rede; investiga√ß√£o regulat√≥ria), gere automaticamente estes 3 arquivos:
 A) CSV com symbol,date,pct_unlock,source (High Risk)
 B) Orderbook snapshot (Binance/Coinbase) para calibra√ß√£o de slippage
 C) Feed de not√≠cias + tweets oficiais (√∫ltimos 30 dias) ‚Äî links + datas

9) Regras / limita√ß√µes do usu√°rio
N√£o proponha mudan√ßas permanentes de tese no briefing di√°rio. Sinalize op√ß√µes/alternativas apenas; decis√µes estrat√©gicas principais ser√£o pedidas em relat√≥rios separados.
Mantenha linguagem curta, bulletizada e pr√°tica ‚Äî sempre cite fontes com timestamps.

10) Entreg√°veis di√°rios m√≠nimos
Texto humano (1 p√°gina) com os blocos A‚ÜíH.
JSON completo (schema acima).
Lista de alerts prontos (datas + a√ß√£o).
Links e timestamps das 3 principais fontes usadas.
Indica√ß√£o ‚ÄúPRIORIDADE‚Äù se houver evento que exija a√ß√£o IMEDIATA.
`;

    const gemText = header + gemTpl;

    // ChatGPT template
    const chatTpl = `
PROMPT DI√ÅRIO ‚Äî An√°lise Matinal (usar sa√≠da Gemini + meu extrato)
Ativos:
${assetsForPrompt}

**PROMPT DI√ÅRIO ‚Äî An√°lise Matinal (usar sa√≠da Gemini + meu extrato)**
Ol√° ‚Äî vou colar abaixo dois blocos: (1) sa√≠da/relat√≥rio do Gemini (an√°lise feita pelo Gemini) e (2) meu Resumo do Investimento com posi√ß√µes atuais. Use ambos como insumos principais. Al√©m disso, integre not√≠cias e dados atuais (√∫ltimas 48‚Äì72 horas) e checks on-chain/dev (√∫ltimos 90 dias) quando relevante. Cite todas as fontes com link + data.
**IMPORTANTE ‚Äî regras de conduta:**
Trate tudo como t√°tico/operacional; n√£o proponha mudan√ßas estrat√©gicas permanentes sem pedido expl√≠cito.

Se faltar dado cr√≠tico (pre√ßo, unlock %), diga ‚ÄúDADO FALTANTE ‚Äî pedir ao Gemini‚Äù e liste o que pedir.

Seja direto, objetivo e claro ‚Äî pronto para eu executar ordens. Use humor leve e sagaz s√≥ se couber (uma linha no m√°ximo).

---

### 1) Dados que vou colar agora (COLAR AQUI)

**A. Sa√≠da do Gemini (an√°lise feita pelo Gemini):**
[COLE AQUI A SA√çDA DO GEMINI]

**B. Meu Resumo do Investimento (cole abaixo):**
[COLE AQUI O RESUMO DO INVESTIMENTO ‚Äî exemplo abaixo para formato padr√£o]

---

### 2) Estrat√©gia base (sempre considerar)

Use estes alvos e tese como refer√™ncia ‚Äî a aloca√ß√£o atual aproximada (mut√°vel) serve s√≥ para an√°lise de risco/aloc:

**Pre√ßos estrat√©gicos de refer√™ncia:**
* AAPL34 R$59
* ETH US$4.000
* SOL US$165
* BABA34 R$22,50‚Äì23,50
* LINK US$22
* SUI US$2.616
* RENDER U$2,76
* MELI34 R$103

**Aloca√ß√£o/vis√£o atual (refer√™ncia):**
* Cripto: ETH 45% / SOL 30% / LINK 15% / SUI 5% / RNDR 5%
* A√ß√µes: BABA34 35% / AAPL34 35% / MELI34 30%

**Tese curta (mantenha):**
* Apple + Ethereum ‚Üí pilares de seguran√ßa.
* Solana + Alibaba ‚Üí meio-termo (risco controlado, potencial bom).
* Chainlink + Sui + Render + MELI ‚Üí alto potencial, risco maior.

---

### 3) Entreg√°veis (formato obrigat√≥rio ‚Äî responda em portugu√™s)

**A. HEADLINE (1 linha)** ‚Äî tema do dia (ex.: ‚ÄúCripto corrigindo; BABA testando suporte; olhar unlocks em X‚Äù).

**B. MARKET SNAPSHOT (3 bullets)**
* Movimentos macro/mercado (cap. cripto 24h, US futures, d√≥lar/juros).
* Evento macro do dia (CPI, FED, earnings relevantes).
* Top 3 riscos que afetam meu portf√≥lio hoje.

**C. TOP MOVERS (Cripto e A√ß√µes)** ‚Äî 5 maiores varia√ß√µes 24h (uma linha cada): Ticker ‚Äî %24h ‚Äî motivo curto ‚Äî a√ß√£o sugerida ‚Äî link.

**D. BLOCOS DOS ATIVOS MONITORADOS** ‚Äî para cada ativo que monitoro hoje (padr√£o: ETH, SOL, LINK, SUI, RNDR, BABA34, AAPL34, MELI34 ‚Äî adapte se eu mudar). Para cada ativo entregue exatamente este bloco:

Ativo: [NOME] ‚Äî [TICKER]
Pre√ßo atual (fonte + timestamp): [valor]
Pre√ßo-alvo do usu√°rio: [valor]
% em rela√ß√£o ao alvo: [+X% / -Y%]  <-- calcule automaticamente
Status: [üö® oportunidade pr√≥xima / Pr√≥ximo / Ainda distante]  <-- regras abaixo
Resumo t√©cnico (PRIORIDADE: Gemini ‚Üí realtime):
* 1D: [Compra / Venda / Neutro] ‚Äî 1 frase (indicador-chave da an√°lise)
* 1S: [Compra / Venda / Neutro] ‚Äî 1 frase
* 1M: [Compra / Venda / Neutro] ‚Äî 1 frase
Observa√ß√µes cr√≠ticas (1‚Äì2 bullets):
* diverg√™ncias (Gemini vs realtime), unlocks (datas + %), falhas de rede, earnings/regula√ß√£o
A√ß√£o pr√°tica (1 linha): [Comprar/Limit/Esperar/Monitorar] ‚Äî pre√ßo-limite sugerido (se aplic√°vel) ‚Äî stop% sugerido
Confian√ßa: [Alta / M√©dia / Baixa]
Fonte(s) (m√°x 3): [link / ‚ÄúGemini an√°lise‚Äù]

**Regras para Status (autom√°tico):**
* Dentro do range-alvo (p.ex. BABA entre R$22,50‚Äì23,50) ‚Üí ‚Äúüö® oportunidade pr√≥xima‚Äù
* At√© 10% acima do alvo ‚Üí ‚ÄúPr√≥ximo‚Äù
* 10% acima do alvo ‚Üí ‚ÄúAinda distante‚Äù

---

**E. SUBSTITUI√á√ÉO/ALTERNATIVAS (t√°tico)**
* Indique alternativas t√°ticas SUGERIDAS (SUI, RNDR) com:
* Range de entrada sugerido (USD) ‚Äî justificativa t√©cnica curta
* Stop % sugerido e TPs (curto/m√©dio)
* 3 op√ß√µes de aloca√ß√£o caso eu queira substituir um ativo de alto risco (Conservadora / Balanceada / Agressiva) mantendo natureza t√°tica.

**F. INSIGHTS & NOT√çCIAS (√∫ltimas 48‚Äì72h)**
* Resuma 3 not√≠cias mais relevantes que afetam meus ativos com link + data e r√°pido impacto (positivo/negativo/neutro).
* Se n√£o houver not√≠cias relevantes, escreva ‚Äúsem not√≠cias fundamentais nas √∫ltimas 72h‚Äù.

**G. ON-CHAIN / DEV CHECKS (quando aplic√°vel)**
* Pr√≥ximos unlocks relevantes (datas + %), TVL movimentos relevantes, dev_commits_90d (varia√ß√£o %), grandes transfers >US$1M (√∫ltimas 72h). Cite fonte.

**H. LIQUIDEZ / EXECU√á√ÉO (quando sugerir compra)**
* Para cada ordem sugerida, estime slippage para ordem de ~0.5% do marketcap nas 2 maiores exchanges (bid/ask depth) e proponha ordem-limit em vez de market se slippage >0.5%.

**I. RISCOS & ALERTS (listagem pronta)**
* Lista dos eventos que precisam de alert (unlocks >1% nos pr√≥ximos 90 dias; auditoria falha; investiga√ß√£o regulat√≥ria) com flags Notify 30/7/1 dias.

**J. A√á√ïES IMEDIATAS (3 linhas ‚Äî para eu executar agora)**
* Ex.: ‚Äú1) Colocar limit BABA34 R$XX; 2) DCA ETH 25% agora, 75% abaixo de US$X; 3) Colocar stop m√≥vel 7% em BABA restante.‚Äù

**K. CONFIDENCE & JSON**
* Confidence geral (Alta/M√©dia/Baixa) + JSON com schema m√≠nimo (symbol, price, target, pct_vs_target, action, stop, confidence). Inclua o JSON ao final da resposta.

`;

    const chatText = header + chatTpl;

    // update visible blocks (title/content placeholder as requested)
    document.getElementById('geminiBlock').textContent = gemText || "üí¨ Instru√ß√µes para o Gemini ‚Äì (cole o template ao editar)";
    document.getElementById('chatgptBlock').textContent = chatText || "üí¨ Mensagem de in√≠cio de conversa para o ChatGPT ‚Äî (cole o template ao editar)";

    // build Python script dynamic part: symbols list (use selection)
    const scriptEl = document.getElementById('scriptBlock');
    let pythonScript = getPythonHeader();

    if(selected.length === 0){
      pythonScript += '\n# Nenhum ativo selecionado\nsymbols = []\n';
    } else {
      const lines = selected.map(s=>`    ("${s.sym}", "${s.url}", "${s.sym} - Sinais 1D-1W-1M.pdf")`);
      pythonScript += '\n# --- S√≠mbolos gerados automaticamente a partir da sele√ß√£o ---\n';
      pythonScript += 'symbols = [\n' + lines.join(',\n') + '\n]\n';
    }

    pythonScript += getPythonMainBlock();
    scriptEl.textContent = pythonScript;

    // store generated payload for copy
    window._generatedGemini = gemText;
    window._generatedChat = chatText;
    window.webScriptText = pythonScript;

    // save selection automatically (store symbols only)
    saveSelection(selected.map(s=>s.sym));
  }

  // === helper returning Python header (imports + helpers) ===
  function getPythonHeader(){
    return `import os
import time
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from fpdf import FPDF
from PIL import Image
from webdriver_manager.chrome import ChromeDriverManager

# --- Pasta de sa√≠da ---
output_folder = os.path.join(os.path.expanduser("~"), "Documents", "CriptoSonho")
os.makedirs(output_folder, exist_ok=True)

# --- Chrome options ---
chrome_options = Options()
chrome_options.add_argument("--headless=new")
chrome_options.add_argument("--hide-scrollbars")
chrome_options.add_argument("--disable-gpu")
chrome_options.add_argument("--no-sandbox")
# evitar problemas de sandbox em alguns ambientes
chrome_options.add_argument("--disable-dev-shm-usage")

driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()), options=chrome_options)
wait = WebDriverWait(driver, 15)

# --- XPaths de timeframe (confirmados por voc√™) ---
TIMEFRAME_XPATHS = {
    "1D": '//*[@id="1D"]/span[1]/span',
    "1W": '//*[@id="1W"]/span[1]/span',
    "1M": '//*[@id="1M"]/span[1]/span'
}

# ---------- Helpers ----------
def click_timeframe(xpath, timeout=8):
    \"\"\"Clica no bot√£o timeframe via JS e tenta aguardar indica√ß√£o de sele√ß√£o (se houver).\"\"\"
    try:
        el = wait.until(EC.element_to_be_clickable((By.XPATH, xpath)))
        driver.execute_script("arguments[0].click();", el)
        try:
            WebDriverWait(driver, 3).until(
                lambda d: ('active' in el.get_attribute("class") or 'selected' in el.get_attribute("class") or el.is_displayed())
            )
        except Exception:
            pass
        time.sleep(1.5)
        return True
    except Exception as e:
        print(f"[click_timeframe] falha ao clicar {xpath}: {e}")
        return False

def save_full_screenshot_tradingview(filename, width=1888, max_height=20000):
    page_w = driver.execute_script("return Math.max(document.body.scrollWidth, document.documentElement.scrollWidth, window.innerWidth);")
    page_h = driver.execute_script("return Math.max(document.body.scrollHeight, document.documentElement.scrollHeight, window.innerHeight);")
    use_w = max(width, page_w)
    use_h = min(int(page_h), max_height)
    driver.set_window_size(use_w, use_h)
    time.sleep(0.6)
    path = os.path.join(output_folder, filename)
    driver.save_screenshot(path)
    print(f"[TradingView screenshot] Salvo: {path} ({use_w}x{use_h})")
    return path

def save_full_screenshot_overview(url, filename, target_width=4950, max_height=12000, wait_after_load=4):
    driver.get(url)
    time.sleep(wait_after_load)
    page_w = driver.execute_script("return Math.max(document.body.scrollWidth, document.documentElement.scrollWidth, window.innerWidth);")
    page_h = driver.execute_script("return Math.max(document.body.scrollHeight, document.documentElement.scrollHeight, window.innerHeight);")
    use_w = max(target_width, page_w)
    use_h = min(int(page_h), max_height)
    driver.set_window_size(use_w, use_h)
    time.sleep(0.8)
    path = os.path.join(output_folder, filename)
    driver.save_screenshot(path)
    print(f"[Overview screenshot] Salvo: {path} ({use_w}x{use_h})")
    return path

def create_pdf_from_images_list(image_paths, pdf_name):
    pdf_path = os.path.join(output_folder, pdf_name)
    if os.path.exists(pdf_path):
        os.remove(pdf_path)
    pdf = FPDF(unit=\"pt\", format=\"A4\")
    page_w, page_h = pdf.w_pt, pdf.h_pt
    for image_path in image_paths:
        img = Image.open(image_path)
        img_w, img_h = img.size
        ratio = min(page_w / img_w, page_h / img_h)
        new_w, new_h = img_w * ratio, img_h * ratio
        x = (page_w - new_w) / 2
        y = (page_h - new_h) / 2
        pdf.add_page()
        pdf.image(image_path, x, y, new_w, new_h)
    pdf.output(pdf_path)
    print(f\"[PDF] Gerado: {pdf_path}\")
    return pdf_path

def safe_remove(path):
    try:
        if os.path.exists(path):
            os.remove(path)
            print(f\"[Removido] {path}\")
    except Exception as e:
        print(f\"[Erro ao remover {path}]: {e}\")
`;
  }

  // Python main block (uses symbols variable)
  function getPythonMainBlock(){
    return `

# ---------- Fluxo principal para s√≠mbolos (1D,1W,1M) ----------
def generate_tradeview_symbol_pdfs(symbols):
    all_images = []
    for symbol, url, pdf_name in symbols:
        print(f"\\n[Processando s√≠mbolo] {symbol} -> {url}")
        imgs = []
        try:
            driver.get(url)
            time.sleep(3)
        except Exception as e:
            print(f"[Erro] N√£o foi poss√≠vel carregar {url}: {e}")
            continue

        for tf, xpath in TIMEFRAME_XPATHS.items():
            ok = click_timeframe(xpath)
            time.sleep(1.2)
            img_filename = f"{symbol}_{tf}.png"
            try:
                img_path = save_full_screenshot_tradingview(img_filename, width=1888, max_height=20000)
                imgs.append(img_path)
                all_images.append(img_path)
            except Exception as e:
                print(f\"[Erro screenshot] {symbol} {tf}: {e}\")

        # gerar PDF por s√≠mbolo
        try:
            create_pdf_from_images_list(imgs, pdf_name)
        except Exception as e:
            print(f\"[Erro PDF] {symbol}: {e}\")

    return all_images

if __name__ == "__main__":
    try:
        # symbols should be defined above (generated dynamically)
        try:
            symbols  # noqa
        except NameError:
            symbols = []

        if len(symbols) > 0:
            technical_images = generate_tradeview_symbol_pdfs(symbols)
        else:
            print("Nenhum s√≠mbolo para processar.")

        overview_pages = [
            ("https://coinmarketcap.com/pt-br/", "CoinMarketCap_full_4950.png"),
            ("https://br.tradingview.com/markets/world-stocks/worlds-largest-companies/", "TradingView_Companies_full_4950.png")
        ]
        overview_images = []
        for url, fname in overview_pages:
            print(f"\\n[Processando vis√£o geral] {url}")
            try:
                img = save_full_screenshot_overview(url, fname, target_width=4950, max_height=12000, wait_after_load=4)
                overview_images.append(img)
            except Exception as e:
                print(f\"[Erro overview] {url}: {e}\")

        if overview_images:
            create_pdf_from_images_list(overview_images, "Relatorio_Cripto_Mercado.pdf")

        print("\\n[Limpeza] removendo imagens tempor√°rias...")
        for p in (technical_images if 'technical_images' in locals() else []) + overview_images:
            safe_remove(p)

        print("\\nTudo pronto ‚Äî PDFs gerados em:", output_folder)

    finally:
        try:
            driver.quit()
        except Exception:
            pass
        print("Conclu√≠do. Driver encerrado.")
`;
  }

  // ===== UI actions =====
  document.addEventListener('click', (e)=>{
    if(e.target && e.target.id==='selectAll'){
      // check all priority + main
      document.querySelectorAll('#priorityContainer input, #assetsContainer input').forEach(i=>i.checked=true);
      updateAllBlocks();
    }
    if(e.target && e.target.id==='clearAll'){
      document.querySelectorAll('#priorityContainer input, #assetsContainer input').forEach(i=>i.checked=false);
      updateAllBlocks();
    }
    if(e.target && e.target.id==='saveBtn'){
      const sel = Array.from(document.querySelectorAll('#priorityContainer input:checked, #assetsContainer input:checked')).map(c=>c.dataset.sym);
      saveSelection(sel);
      localStorage.setItem(TEMPLATE_KEY_G, document.getElementById('geminiTemplate').value || '');
      localStorage.setItem(TEMPLATE_KEY_C, document.getElementById('chatTemplate').value || '');
      _showToast('Sele√ß√£o e templates salvos');
    }
    if(e.target && e.target.id==='copyGemini'){
      _copyString(window._generatedGemini || '');
    }
    if(e.target && e.target.id==='copyChat'){
      _copyString(window._generatedChat || '');
    }
    if(e.target && e.target.id==='toggleGeminiTemplate'){
      const ta = document.getElementById('geminiTemplate'); ta.style.display = (ta.style.display==='none')? 'block':'none';
    }
    if(e.target && e.target.id==='toggleChatTemplate'){
      const ta = document.getElementById('chatTemplate'); ta.style.display = (ta.style.display==='none')? 'block':'none';
    }
    if(e.target && e.target.id==='copyScriptBtn'){
      _copyString(window.webScriptText || '');
    }
  });

  // copy helpers
  function copyText(ev, text){
    if (ev) ev.stopPropagation();
    _copyString(text);
  }

  // delegate click-to-copy for text blocks
  document.querySelectorAll('[data-copy]').forEach(el=>{
    el.addEventListener('click', ()=>_copyString(el.textContent.trim()));
  });

  function _copyString(text){
    if(!text) return _showToast('Nada pra copiar');
    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(text).then(()=>_showToast('Copiado!'), ()=>_fallbackCopy(text));
    } else {
      _fallbackCopy(text);
    }
  }

  function _fallbackCopy(text){
    try {
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position = 'fixed';
      ta.style.left = '-9999px';
      document.body.appendChild(ta);
      ta.select();
      const ok = document.execCommand('copy');
      document.body.removeChild(ta);
      _showToast(ok ? 'Copiado!' : 'Falha ao copiar');
    } catch (e){
      _showToast('Falha ao copiar');
    }
  }

  function _showToast(msg){
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.style.opacity = '1';
    t.style.transform = 'translateY(0)';
    t.style.pointerEvents = 'auto';
    setTimeout(()=>{t.style.opacity='0';t.style.transform='translateY(12px)';t.style.pointerEvents='none';}, 1600);
  }

  // initial render + load
  renderAssets();
  // small delay to ensure elements exist before binding
  setTimeout(loadSelection, 120);
}); // DOMContentLoaded end
</script>
</body>
</html>
